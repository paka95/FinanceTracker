{% extends "layout.html" %} 
{% block title %}Finase{% endblock %}

{% block button %}


<div class="dropdown">
    <a class="dropdown-toggle logout-button" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Options
    </a>
  
    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
      <a class="dropdown-item" href="/profile">Profile</a>
      <a class="dropdown-item" href="/logout">Logout</a>
    </div>
  </div>


{% endblock %}

{% block content %}


<div class="main-form">


<div style="padding: 10px; display: flex; height: 100%">
    <div style="width: 60%; text-align: center; padding: 10px">
        <form method="POST" action="#">
            <div style="display: flex; width: 100%; justify-content: space-evenly;">
                <button type="submit" class="date-button" formaction="/">TODAY</button>
                <input type=date id=date_picker name="chosen_data" value="{{terazdata}}" onchange="goTo()">
                <button type="submit" id="goto" class="date-button" style="display:none">GO TO</button>
            </div>
        </form>
        

        <div style="width: 100%; height: 2px; background-color: rgb(53, 24, 75); margin-top: 10px; margin-bottom: 10px;"></div>

        <div style="height: 300px; overflow-y: auto; overflow-x: hidden; padding: 10px">
        {% for expense in expenses %}

        <button class="expense_list" type="button" data-toggle="modal" data-target="#edit{{expense.id}}"> 
            <div style="width: 10%; font-weight: bold;">{{ expense.date_created.strftime('%H:%M') }} </div>
            <div style="width: 35%; font-weight: bold; text-overflow: ellipsis; overflow: hidden; height:20px ">{{ expense.name }} </div>
            <div style="width: 20%; font-weight: bold;">{{ expense.label }}</div> 
            <div style="width: 25%; font-weight: bold; text-overflow: ellipsis; overflow: hidden; height: 20px">
                {% if user.currency == "zł" %}
                    {{ expense.amount }} {{user.currency}}
                {% else %}
                    {{user.currency}}{{ expense.amount }}
                {% endif %}
            </div>
        </button>



        
        <!-- Update modal -->
        <div class="modal fade" id="edit{{expense.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" style="font-family: Play;" id="exampleModalLabel"></h5>
                <div>Added on {{expense.date_created}}</div>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
                
                

                <form method="POST" action="/change_expense/{{expense.id}}">
      
                    <div class="modal-body">
                        <div style="display: flex; justify-content: space-evenly;">
                            <input type=date style="display:none" name="chosen_data_in_form" value="{{terazdata}}">
                            <input type="text" class="tooltip-test update_expense_form" title="{{expense.name}}" name="updatename" id="updatename" value="{{expense.name}}" autocomplete="off">
                            
                            <select id="updatelabel" name="updatelabel" class="update_expense_form">
                                <option value="select" disabled selected hidden>{{expense.label}}</option>
                                <option value="Transport">Transport</option>
                                <option value="Bills">Bills</option>
                                <option value="Food">Food</option>
                                <option value="Misc">Misc</option>
                                <option value="Fees">Fees</option>
                            </select>

                            {% if user.currency == "zł" %}
                                <input type="text" class="update_expense_form" name="updateamount" id="updateamount" value="{{expense.amount}} {{user.currency}}" autocomplete="off">
                            {% else %}
                                <input type="text" class="update_expense_form" name="updateamount" id="updateamount" value="{{user.currency}}{{expense.amount}}" autocomplete="off">
                            {% endif %}
                        </div>
                    </div>
                    <div style="display:flex; justify-content: space-evenly; padding: 10px">
                        <button class="update_button" type="submit" >Update</button>
                        <button class="delete_button" data-dismiss="modal" data-toggle="modal" data-target="#delete{{expense.id}}">Delete</button> 
                    </div>
                  </form>
            </div>
            </div>
        </div>


        <!-- Delete confirmation modal -->
        <div class="modal fade" id="delete{{expense.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" class="rusure" id="exampleModalLabel"><b>Are you sure you want to delete this expense?</b></h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
        
                <form method="POST" action="/delete_expense/{{expense.id}}">
        
                    <input type=date style="display:none" name="chosen_data_in_form" value="{{terazdata}}">
                  <div style="display: flex; justify-content: space-evenly; padding: 10px">
                    <button class="update_button" data-dismiss="modal" >No</button>
                    <button class="delete_button" formaction="/delete_expense/{{expense.id}}">Yes</button>
                  </div>
                </form>
              </div>
            </div>
          </div>


        <div style="width: 100%; height: 1px; background-color: rgb(53, 24, 75); margin-top: 5px; margin-bottom: 5px;"></div>
        {% endfor %}
        </div>


        <div style="width: 100%; height: 2px; background-color: rgb(53, 24, 75); margin-top: 10px; margin-bottom: 10px;"></div>

        <div>
            <div style="font-size: 20px; display:flex; justify-content: space-between; padding-right: 35px; padding-left: 35px;">
                <div>daily expenses:</div>
                <div style="width: 100px; text-overflow: ellipsis; overflow: hidden; height: 30px" class="tooltip-test" title="{{total_expenses}} {{user.currency}}">
                    {% if user.currency == "zł" %}
                        {{ total_expenses }} {{user.currency}}
                    {% else %}
                        {{user.currency}}{{ total_expenses }}
                    {% endif %}
                </div>
            </div>
            <div style="width: 100%; height: 1px; background-color: black; margin-top: 5px; margin-bottom: 5px;"></div>
            <div style="font-size: 20px; display:flex; justify-content: space-between; padding-right: 35px; padding-left: 35px;">
                <div><a href="/preview/{{terazdata}}" class="monthly_expenses_button">monthly expenses:</a></div>
                <div style="width: 100px; text-overflow: ellipsis; overflow: hidden; height: 30px" class="tooltip-test" title="{{montly_rounded}} {{user.currency}}">
                    {% if user.currency == "zł" %}
                        {{montly_rounded}} {{user.currency}}
                    {% else %}
                        {{user.currency}}{{montly_rounded}}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <form style="width: 40%;" method="POST">
        {{ form.hidden_tag() }}
        <div style="padding: 20px; text-align: center; height: 320px; margin-top: 50px; ">
            <input type=date style="display:none" name="chosen_data_in_form" value="{{terazdata}}">
            {{ form.name (placeholder="Name", autocomplete="off", class="add_expense_form") }}
            <select id="labell" name="labell" class="add_expense_form">
                <option value="select" disabled selected hidden>Select a label</option>
                <option value="Transport">Transport</option>
                <option value="Bills">Bills</option>
                <option value="Food">Food</option>
                <option value="Misc">Misc</option>
                <option value="Fees">Fees</option>
            </select>
            {{ form.amount (placeholder="Amount", autocomplete="off", class="add_expense_form") }}
            {{ form.submit (class="add_expense_button") }}
        </div>
    </form>
</div>
    
</div>



<script>
function goTo() {
    document.getElementById("goto").click();
}
</script>


{% endblock %}  